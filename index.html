<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>quqå°æ‰‹æœº</title>
    <!-- ä¿®å¤1ï¼šç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡® -->
    <base href="./">
    <!-- ä¿®å¤2ï¼šé˜²æ­¢æµè§ˆå™¨æ¨¡å¼é—®é¢˜ -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* æç®€åŠ è½½æ ·å¼ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 500;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* å¼€å‘å·¥å…·é¢æ¿ */
        .dev-tools-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 10px;
            color: white;
            font-size: 12px;
            z-index: 9998;
            display: none;
        }
        
        .dev-tools-panel.show {
            display: block;
        }
        
        .dev-tools-btn {
            background: #07c160;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 2px;
            cursor: pointer;
            font-size: 11px;
        }
        
        /* å¤‡ä»½çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .backup-status-indicator {
            position: fixed;
            bottom: 70px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(7, 193, 96, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 99;
            box-shadow: 0 6px 20px rgba(7, 193, 96, 0.3);
            transition: all 0.3s ease;
            display: none;
        }
        
        .backup-status-indicator:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- åŠ è½½å± - ç®€åŒ–ç‰ˆæœ¬ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">quqå°æ‰‹æœºåŠ è½½ä¸­...</div>
        <!-- é”™è¯¯æç¤ºåŒºåŸŸ -->
        <div id="errorMessage" style="display: none; margin-top: 20px; padding: 15px; background: rgba(255,0,0,0.1); border-radius: 10px; max-width: 80%; color: #ff4444; font-size: 14px;"></div>
    </div>
    
    <!-- å¼€å‘å·¥å…·é¢æ¿ï¼ˆå¼€å‘æ—¶å¯ç”¨ï¼‰ -->
    <div class="dev-tools-panel" id="devToolsPanel">
        <button class="dev-tools-btn" onclick="DevTools.clearAllData()">æ¸…ç©ºæ•°æ®</button>
        <button class="dev-tools-btn" onclick="DevTools.generateTestData()">æµ‹è¯•æ•°æ®</button>
        <button class="dev-tools-btn" onclick="DevTools.quickBackup()">å¿«é€Ÿå¤‡ä»½</button>
        <button class="dev-tools-btn" onclick="DevTools.createBackup()">å®Œæ•´å¤‡ä»½</button>
        <button class="dev-tools-btn" onclick="DevTools.togglePanel()">éšè—</button>
    </div>
    
    <!-- å¤‡ä»½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="backup-status-indicator" id="backupIndicator" onclick="DevTools.createBackup()">
        <i class="fas fa-save"></i>
    </div>
    
    <!-- ä¸»åº”ç”¨å®¹å™¨ -->
    <div class="app-container" id="app" style="display: none;">
        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="time" id="currentTime">00:00</div>
            <div class="status-icons">
                <div class="network-status">
                    <div class="signal-bars">
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                    </div>
                    <div class="wifi-icon"></div>
                </div>
                <div class="battery-container" id="batteryContainer">
                    <div class="battery-icon">
                        <div class="battery-level" id="batteryLevel"></div>
                        <div class="battery-tip"></div>
                    </div>
                    <div class="battery-percentage" id="batteryPercentage">--%</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- èŠå¤©é¡µé¢ -->
            <div class="page active" id="chatPage">
                <div class="chat-header">
                    <div class="chat-title">è”ç³»äºº</div>
                    <button class="add-role-btn" id="addRoleBtn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="chat-list" id="chatList">
                    <div class="no-contacts">
                        <div class="no-contacts-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>æš‚æ— è”ç³»äºº</div>
                        <div style="font-size: 14px; margin-top: 10px; color: #666;">
                            ç‚¹å‡»å³ä¸Šè§’æ·»åŠ æŒ‰é’®åˆ›å»ºè”ç³»äºº
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- åŠ¨æ€é¡µé¢ -->
            <div class="page" id="momentsPage">
                <div class="moments-header">
                    <div class="cover-background" id="coverBackground">
                        <button class="cover-edit-btn" id="editCoverBtn">
                            <i class="fas fa-camera"></i>
                            <span>ç¼–è¾‘å°é¢</span>
                        </button>
                        <div class="user-info-area">
                            <div class="user-avatar-container">
                                <img src="" alt="" class="user-avatar" id="userAvatar">
                                <button class="avatar-edit-btn" id="editAvatarBtn">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                            <div class="user-name" id="userName">ç”¨æˆ·</div>
                            <div class="user-bio" id="userBio">ç‚¹å‡»ç¼–è¾‘ä¸ªæ€§ç­¾å</div>
                            <!-- åŠ¨æ€æ ‡ç­¾å®¹å™¨ -->
                            <div class="dynamic-tags-container" id="dynamicTagsContainer">
                                <!-- æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="moments-list" id="momentsList">
                    <div class="no-moments">
                        <div class="no-moments-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div>è¿˜æ²¡æœ‰åŠ¨æ€</div>
                        <div style="font-size: 14px; margin-top: 10px; color: #666;">
                            ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®å‘å¸ƒç¬¬ä¸€æ¡åŠ¨æ€
                        </div>
                    </div>
                </div>
                <button class="add-moment-btn" id="addMomentBtn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <!-- ä¸ªäººé¡µé¢ -->
            <div class="page" id="profilePage">
                <div class="profile-header">
                    <div class="profile-avatar-name-container">
                        <div class="profile-avatar-container">
                            <img src="" alt="" class="profile-avatar" id="profileAvatar">
                            <button class="profile-avatar-edit-btn" id="editProfileAvatarBtn">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <div class="profile-name-info">
                            <div class="profile-name" id="profileName">ç”¨æˆ·</div>
                            <div class="profile-id" id="profileId">ID: ç‚¹å‡»è®¾ç½®</div>
                            <div class="profile-signature" id="profileSignature">ç‚¹å‡»ç¼–è¾‘ä¸ªæ€§ç­¾å</div>
                            <div class="profile-status-tags-container">
                                <div class="profile-status" id="profileStatus">
                                    <span id="statusText">ç‚¹å‡»è®¾ç½®çŠ¶æ€</span>
                                </div>
                                <!-- æ ‡ç­¾æ”¾åœ¨çŠ¶æ€ä¸‹ï¼Œæ°´å¹³æ’åˆ— -->
                                <div class="profile-tags-container" id="profileTagsContainer">
                                    <!-- æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-menu">
                    <!-- å¤‡ä»½ä¸æ¢å¤ -->
                    <div class="menu-item" id="backupBtn">
                        <div class="menu-icon">
                            <i class="fas fa-save"></i>
                        </div>
                        <div class="menu-text">å¤‡ä»½ä¸æ¢å¤</div>
                    </div>
                    <!-- æˆ‘çš„è”ç³»äºº -->
                    <div class="menu-item" id="myRolesBtn">
                        <div class="menu-icon">
                            <i class="fas fa-address-book"></i>
                        </div>
                        <div class="menu-text">æˆ‘çš„è”ç³»äºº</div>
                    </div>
                    <!-- è®¾ç½® -->
                    <div class="menu-item" id="settingsBtn">
                        <div class="menu-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="menu-text">è®¾ç½®</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-bar">
            <div class="tab-item active" data-tab="chat">
                <div class="tab-icon"><i class="fas fa-comments"></i></div>
                <div class="tab-text">èŠå¤©</div>
            </div>
            <div class="tab-item" data-tab="moments">
                <div class="tab-icon"><i class="fas fa-camera"></i></div>
                <div class="tab-text">åŠ¨æ€</div>
            </div>
            <div class="tab-item" data-tab="profile">
                <div class="tab-icon"><i class="fas fa-user"></i></div>
                <div class="tab-text">ä¸ªäºº</div>
            </div>
        </div>
    </div>
    
    <!-- å¼¹çª—å®¹å™¨ï¼ˆè¿™äº›ä¼šç”±JSåŠ¨æ€åˆ›å»ºï¼‰ -->
    <div id="modalContainer"></div>
    <div id="floatContainer"></div>
    <div id="dialogContainer"></div>
    
    <!-- å¼•å…¥å¼€å‘å·¥å…· -->
    <script src="dev-tools.js"></script>
    
    <!-- å¼•å…¥ä¸»åº”ç”¨ -->
    <script src="app.js"></script>
    
    <script>
        // ========== æ‰‹æœºç«¯å®‰å…¨å¯åŠ¨è„šæœ¬ ==========
        console.log('ğŸ“± æ‰‹æœºç«¯å¯åŠ¨è„šæœ¬å¼€å§‹');
        
        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
        function checkBrowserSupport() {
            var unsupported = false;
            var errorMsg = '';
            
            try {
                // æ£€æŸ¥localStorage
                if (typeof localStorage === 'undefined') {
                    unsupported = true;
                    errorMsg = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨(localStorage)';
                }
                
                // æ£€æŸ¥JSON
                if (typeof JSON === 'undefined') {
                    unsupported = true;
                    errorMsg = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒJSON';
                }
                
                // å°è¯•ä½¿ç”¨ES6è¯­æ³•
                eval('const test = 1;');
                
            } catch (e) {
                unsupported = true;
                errorMsg = 'æµè§ˆå™¨JavaScriptæ”¯æŒä¸å®Œæ•´';
            }
            
            return { unsupported: unsupported, errorMsg: errorMsg };
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            var loadingText = document.getElementById('loadingText');
            var errorDiv = document.getElementById('errorMessage');
            
            if (loadingText) loadingText.textContent = 'åŠ è½½é‡åˆ°é—®é¢˜';
            if (errorDiv) {
                errorDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">${message}</div>
                    <div style="font-size: 13px; margin-bottom: 10px;">å»ºè®®ä½¿ç”¨ Chromeã€Firefoxã€Safari æˆ– Edge æµè§ˆå™¨</div>
                    <button onclick="location.reload()" style="padding: 10px 20px; background: #07c160; color: white; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer;">
                        åˆ·æ–°é¡µé¢
                    </button>
                    <button onclick="showSimpleVersion()" style="padding: 10px 20px; background: #1890ff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        ç®€åŒ–ç‰ˆæœ¬
                    </button>
                `;
                errorDiv.style.display = 'block';
            }
        }
        
        // æ˜¾ç¤ºç®€åŒ–ç‰ˆæœ¬
        function showSimpleVersion() {
            window.location.href = 'quq-mobile.html';
        }
        
        // å®‰å…¨å¯åŠ¨åº”ç”¨
        function safeStartApp() {
            console.log('ğŸ”„ å¼€å§‹å®‰å…¨å¯åŠ¨æµç¨‹');
            
            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            var support = checkBrowserSupport();
            if (support.unsupported) {
                showError(support.errorMsg);
                return;
            }
            
            // è®¾ç½®è¶…æ—¶æœºåˆ¶ï¼š8ç§’åå¼ºåˆ¶æ˜¾ç¤º
            var forceShowTimer = setTimeout(function() {
                console.log('â° è¶…æ—¶ä¿æŠ¤ï¼šå¼ºåˆ¶æ˜¾ç¤ºåº”ç”¨ç•Œé¢');
                var loading = document.getElementById('loadingScreen');
                var app = document.getElementById('app');
                if (loading && app) {
                    loading.style.display = 'none';
                    app.style.display = 'flex';
                    // æ˜¾ç¤ºç®€å•çš„æç¤º
                    if (typeof Utils !== 'undefined') {
                        Utils.showToast('åº”ç”¨å°±ç»ª');
                    }
                }
            }, 8000);
            
            // è®¾ç½®åŒå‡»çŠ¶æ€æ äº‹ä»¶ï¼ˆå¼€å‘å·¥å…·ï¼‰
            setupDevTools();
            
            console.log('âœ… å¯åŠ¨æ£€æŸ¥å®Œæˆï¼Œç­‰å¾…ä¸»åº”ç”¨åˆå§‹åŒ–');
        }
        
        // è®¾ç½®å¼€å‘å·¥å…·åŒå‡»äº‹ä»¶
        function setupDevTools() {
            var tapCount = 0;
            var lastTapTime = 0;
            var statusBar = document.querySelector('.status-bar');
            
            if (statusBar) {
                statusBar.addEventListener('click', function() {
                    var currentTime = Date.now();
                    if (currentTime - lastTapTime < 300) {
                        tapCount++;
                        if (tapCount >= 5) {
                            var panel = document.getElementById('devToolsPanel');
                            if (panel) {
                                panel.classList.add('show');
                                console.log('ğŸ”§ å¼€å‘å·¥å…·å·²æ˜¾ç¤º');
                            }
                            tapCount = 0;
                        }
                    } else {
                        tapCount = 1;
                    }
                    lastTapTime = currentTime;
                    
                    setTimeout(function() {
                        tapCount = 0;
                    }, 5000);
                });
            }
        }
        
        // æ£€æŸ¥å¤‡ä»½æé†’
        function checkBackupReminder() {
            var lastBackupTime = localStorage.getItem('last_auto_backup');
            if (lastBackupTime) {
                var lastTime = parseInt(lastBackupTime);
                var now = Date.now();
                var daysSinceLastBackup = Math.floor((now - lastTime) / (1000 * 60 * 60 * 24));
                
                // å¦‚æœè¶…è¿‡3å¤©æ²¡æœ‰å¤‡ä»½ï¼Œæ˜¾ç¤ºæé†’
                if (daysSinceLastBackup >= 3) {
                    var backupIndicator = document.getElementById('backupIndicator');
                    if (backupIndicator) {
                        backupIndicator.style.display = 'flex';
                        backupIndicator.title = 'å»ºè®®å¤‡ä»½æ•°æ®ï¼Œå·²ç» ' + daysSinceLastBackup + ' å¤©æ²¡æœ‰å¤‡ä»½äº†';
                    }
                }
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹å¯åŠ¨');
            setTimeout(safeStartApp, 100);
        });
        
        // æ£€æŸ¥å¤‡ä»½æé†’
        setTimeout(checkBackupReminder, 3000);
        
        console.log('ğŸ“± æ‰‹æœºç«¯å¯åŠ¨è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html>